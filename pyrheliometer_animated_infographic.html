<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pyrheliometer – Animated Direct Normal Irradiance Measurement</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --bg-color: #f8f9fa;
            --text-color: #333;
            --panel-bg: #ffffff;
            --accent-color: #ff9800;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
            font-weight: 600;
        }

        .container {
            background: var(--panel-bg);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 30px;
            max-width: 900px;
            width: 100%;
            box-sizing: border-box;
            position: relative;
        }

        /* SVG Container */
        .svg-wrapper {
            width: 100%;
            position: relative;
            margin-bottom: 20px;
            overflow: visible; 
        }

        svg {
            width: 100%;
            height: auto;
            max-height: 500px;
            display: block;
            margin: 0 auto;
            user-select: none; 
        }

        /* Interactive Elements Styling */
        .interactive-part {
            cursor: pointer;
            transition: opacity 0.3s;
        }
        .interactive-part:hover {
            opacity: 0.8; 
            filter: brightness(1.1);
        }

        /* Tooltip */
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 250px;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            line-height: 1.4;
        }
        #tooltip strong {
            display: block;
            margin-bottom: 4px;
            color: var(--accent-color);
        }

        /* Controls Section */
        .controls {
            background: #eef2f5;
            padding: 20px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .slider-container {
            width: 100%;
            max-width: 600px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        label {
            font-weight: bold;
            white-space: nowrap;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #d3d3d3;
            border-radius: 5px;
            outline: none;
            transition: background 0.2s;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .value-display {
            background: #fff;
            padding: 8px 16px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            min-width: 90px;
            text-align: right;
        }

        /* Description Text */
        .description {
            line-height: 1.6;
            color: #555;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        .description h3 {
            color: #2c3e50;
            margin-top: 0;
        }

        /* Animation Styles */
        @keyframes rayFlow {
            0% { stroke-dashoffset: 40; }
            100% { stroke-dashoffset: 0; }
        }
        
        @keyframes trackWobble {
            0% { transform: rotate(-30deg); }
            50% { transform: rotate(-29.5deg); }
            100% { transform: rotate(-30deg); }
        }

        .ray-line {
            animation: rayFlow 1s linear infinite;
        }
        
        /* The entire instrument points at the sun */
        #instrumentAssembly {
            transform-origin: 400px 400px;
            transform: rotate(-30deg);
            /* Optional subtle tracking movement simulation */
            /* animation: trackWobble 10s ease-in-out infinite; */ 
        }

        /* Responsive */
        @media (max-width: 600px) {
            .slider-container {
                flex-direction: column;
                gap: 10px;
            }
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <h1>Pyrheliometer – Direct Solar Irradiance</h1>

    <div class="container">
        <div id="tooltip"></div>

        <div class="svg-wrapper" id="svgContainer">
            <svg viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <!-- Metal Gradient -->
                    <linearGradient id="metalGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#bdc3c7;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#f5f6fa;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#95a5a6;stop-opacity:1" />
                    </linearGradient>

                    <!-- Tube Interior Gradient -->
                    <linearGradient id="tubeInnerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#2c3e50;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#34495e;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#2c3e50;stop-opacity:1" />
                    </linearGradient>

                    <!-- Quartz Window Gradient -->
                    <linearGradient id="glassGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.6" />
                        <stop offset="100%" style="stop-color:#a2d9ff;stop-opacity:0.2" />
                    </linearGradient>
                    
                    <!-- Heat Glow Gradient -->
                    <radialGradient id="heatGrad" cx="50%" cy="50%" r="50%">
                        <stop offset="0%" style="stop-color:#ff4d4d;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#ff0000;stop-opacity:0" />
                    </radialGradient>

                    <!-- Arrow Marker -->
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                    refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#ff9800" />
                    </marker>
                    
                    <!-- Shadow Filter -->
                    <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
                        <feGaussianBlur in="SourceAlpha" stdDeviation="3"/> 
                        <feOffset dx="3" dy="3" result="offsetblur"/>
                        <feComponentTransfer>
                            <feFuncA type="linear" slope="0.3"/>
                        </feComponentTransfer>
                        <feMerge> 
                            <feMergeNode/>
                            <feMergeNode in="SourceGraphic"/> 
                        </feMerge>
                    </filter>
                </defs>

                <!-- --- Background Elements --- -->
                <!-- The Sun (Target) -->
                <g id="theSun" transform="translate(100, 80)">
                    <circle cx="0" cy="0" r="40" fill="#f1c40f" filter="url(#dropShadow)" />
                    <circle cx="0" cy="0" r="45" fill="none" stroke="#f39c12" stroke-width="2" stroke-dasharray="5,5" opacity="0.5">
                        <animateTransform attributeName="transform" type="rotate" from="0 0 0" to="360 0 0" dur="20s" repeatCount="indefinite" />
                    </circle>
                    <text x="0" y="60" text-anchor="middle" font-size="12" fill="#7f8c8d">Sun (Source)</text>
                </g>

                <!-- Light Beam Path (Conceptual) -->
                <path d="M 100 80 L 400 400" stroke="#f1c40f" stroke-width="100" stroke-opacity="0.05" />

                <!-- --- Main Instrument Assembly (Rotated to face sun) --- -->
                <g id="instrumentAssembly">
                    
                    <!-- 1. Body / Heat Sink -->
                    <g class="interactive-part" data-name="Instrument Body" data-desc="Provides a stable thermal mass (heat sink) to maintain the cold junctions of the thermopile at a constant reference temperature.">
                        <!-- Main Housing Block -->
                        <rect x="350" y="350" width="100" height="150" fill="url(#metalGrad)" rx="5" filter="url(#dropShadow)" />
                        <!-- Connection to Tube -->
                        <path d="M 370 350 L 370 330 L 430 330 L 430 350 Z" fill="#95a5a6" />
                    </g>

                    <!-- 2. Collimation Tube -->
                    <g class="interactive-part" data-name="Collimation Tube" data-desc="A long tube with baffles that restricts the Field of View (FOV) to approx. 5°, ensuring only direct solar rays reach the sensor.">
                        <!-- Tube Outer Shell -->
                        <rect x="365" y="100" width="70" height="230" fill="url(#metalGrad)" stroke="#7f8c8d" rx="2" filter="url(#dropShadow)" />
                        
                        <!-- Tube Interior (Cutaway) -->
                        <rect x="370" y="105" width="60" height="220" fill="url(#tubeInnerGrad)" stroke="#2c3e50" />
                        
                        <!-- Baffles (Stray light blockers) -->
                        <line x1="370" y1="140" x2="380" y2="140" stroke="#111" stroke-width="2" />
                        <line x1="430" y1="140" x2="420" y2="140" stroke="#111" stroke-width="2" />
                        
                        <line x1="370" y1="180" x2="380" y2="180" stroke="#111" stroke-width="2" />
                        <line x1="430" y1="180" x2="420" y2="180" stroke="#111" stroke-width="2" />
                        
                        <line x1="370" y1="220" x2="380" y2="220" stroke="#111" stroke-width="2" />
                        <line x1="430" y1="220" x2="420" y2="220" stroke="#111" stroke-width="2" />
                    </g>

                    <!-- 3. Quartz Window -->
                    <g class="interactive-part" data-name="Quartz Window" data-desc="Protects the interior from dust and moisture while transmitting the full solar spectrum (200nm - 4000nm).">
                        <rect x="365" y="100" width="70" height="5" fill="url(#glassGrad)" stroke="#a2d9ff" />
                        <!-- Reflection -->
                        <line x1="370" y1="102" x2="385" y2="102" stroke="white" opacity="0.8" />
                    </g>

                    <!-- 4. Sensor & Thermopile (At bottom of tube) -->
                    <g transform="translate(0, 0)">
                         <!-- Heat Glow behind absorber -->
                         <circle id="heatGlow" cx="400" cy="320" r="25" fill="url(#heatGrad)" opacity="0" pointer-events="none" />

                         <!-- Thermopile Schematic -->
                         <g class="interactive-part" data-name="Thermopile" data-desc="Located behind the black absorber. Converts the temperature difference between the absorber and the body into voltage.">
                            <path d="M 380 330 L 385 340 L 390 330 L 395 340 L 400 330 L 405 340 L 410 330 L 415 340 L 420 330" 
                                  fill="none" stroke="#e74c3c" stroke-width="2" />
                            <rect x="375" y="340" width="50" height="10" fill="#3498db" opacity="0.5" rx="2" />
                         </g>

                         <!-- Black Absorber Surface -->
                         <g class="interactive-part" data-name="Black Absorber" data-desc="A matte black disc at the bottom of the tube that absorbs the collimated solar beam.">
                             <rect x="375" y="320" width="50" height="5" fill="#000" stroke="#333" />
                         </g>
                    </g>

                    <!-- 5. Solar Rays (Inside Tube) -->
                    <g id="solarRays">
                        <!-- Direct Beams - strictly parallel -->
                        <line x1="385" y1="0" x2="385" y2="320" class="ray-line" stroke="#ff9800" stroke-width="2" stroke-dasharray="10, 10" />
                        <line x1="400" y1="-20" x2="400" y2="320" class="ray-line" stroke="#ff9800" stroke-width="2" stroke-dasharray="10, 10" />
                        <line x1="415" y1="0" x2="415" y2="320" class="ray-line" stroke="#ff9800" stroke-width="2" stroke-dasharray="10, 10" />
                    </g>

                </g> <!-- End Rotated Assembly -->


                <!-- --- Wiring & Output --- -->
                <!-- Wire coming out of the rotated body -->
                <path d="M 500 450 C 550 450, 600 450, 600 400" fill="none" stroke="#333" stroke-width="4" />
                
                <!-- Meter Box (Static Position) -->
                <g transform="translate(600, 360)">
                    <rect x="0" y="0" width="120" height="80" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2" rx="4" filter="url(#dropShadow)" />
                    <text x="60" y="20" text-anchor="middle" font-size="10" fill="#7f8c8d">OUTPUT SIGNAL (mV)</text>
                    
                    <!-- Meter Display Area -->
                    <rect x="10" y="30" width="100" height="40" fill="#2c3e50" rx="2" />
                    <text id="voltageText" x="60" y="55" text-anchor="middle" font-family="monospace" font-weight="bold" font-size="16" fill="#00ff00">0.00 mV</text>
                    
                    <!-- Small LED -->
                    <circle id="statusLed" cx="110" cy="10" r="4" fill="#555" />
                </g>

                <!-- --- Labels with Leader Lines (Recalculated for -30deg rotation) --- -->
                <g stroke="#333" stroke-width="1" fill="none">
                    
                    <!-- Tube Label -->
                    <!-- Pointing to the side of the rotated tube approx (270, 244) -->
                    <path d="M 270 244 L 180 244" />
                    <text x="175" y="249" text-anchor="end" fill="#333" font-size="14" font-weight="500">Collimation Tube</text>

                    <!-- Aperture Label -->
                    <!-- Pointing to the tip of the rotated window approx (250, 140) -->
                    <path d="M 250 140 L 180 100" />
                    <text x="175" y="105" text-anchor="end" fill="#333" font-size="14" font-weight="500">Quartz Window (Aperture)</text>

                    <!-- Sensor Label -->
                    <!-- Pointing to the sensor location inside the body approx (360, 340) - moved right and up slightly -->
                    <path d="M 360 340 L 580 340" />
                    <text x="585" y="345" text-anchor="start" fill="#333" font-size="14" font-weight="500">Thermopile Sensor</text>

                    <!-- Tracker Axis Label (Conceptual) -->
                    <!-- Pointing to the pivot point (400, 400) -->
                    <path d="M 400 420 L 400 470" stroke-dasharray="2,2" />
                    <text x="400" y="485" text-anchor="middle" fill="#7f8c8d" font-size="14">Tracking Axis</text>
                </g>

            </svg>
        </div>

        <div class="controls">
            <div class="slider-container">
                <label for="dniSlider">DNI (Direct Normal Irradiance):</label>
                <input type="range" id="dniSlider" min="0" max="1200" value="0" step="10">
                <div class="value-display" id="dniValue">0 W/m²</div>
            </div>
        </div>

        <div class="description">
            <h3>How it Works</h3>
            <p>
                A <strong>pyrheliometer</strong> is designed to measure <em>Direct Normal Irradiance (DNI)</em>—solar radiation coming directly from the sun without scattering. It must be mounted on a <strong>solar tracker</strong> to follow the sun's movement throughout the day.
            </p>
            <p>
                1. <strong>Collimation:</strong> The long tube acts as a collimator, restricting the Field of View (FOV) to roughly 5°. This physically blocks diffuse light from the sky and ground, allowing only direct beams to enter.<br>
                2. <strong>Absorption:</strong> The rays hit a black absorber at the bottom of the tube, creating heat.<br>
                3. <strong>Measurement:</strong> A thermopile converts this heat into a precision electrical signal proportional to the beam intensity.
            </p>
            <p style="font-size: 0.9em; color: #777; margin-top: 15px;">
                <em>Interact with the diagram: Hover over components for details and adjust the slider to simulate direct sunlight intensity.</em>
            </p>
        </div>
    </div>

    <script>
        // DOM Elements
        const slider = document.getElementById('dniSlider');
        const displayValue = document.getElementById('dniValue');
        const voltageText = document.getElementById('voltageText');
        const heatGlow = document.getElementById('heatGlow');
        const solarRays = document.getElementById('solarRays');
        const statusLed = document.getElementById('statusLed');
        const svgContainer = document.getElementById('svgContainer');
        const tooltip = document.getElementById('tooltip');

        // Constants
        const MAX_DNI = 1200; // W/m^2
        const SENSITIVITY = 0.008; // mV per W/m^2 (Typical roughly 7-9 microvolts per W/m2 for Pyrheliometers)

        // Tooltip Logic
        const interactiveParts = document.querySelectorAll('.interactive-part');

        interactiveParts.forEach(part => {
            part.addEventListener('mousemove', (e) => {
                const name = part.getAttribute('data-name');
                const desc = part.getAttribute('data-desc');
                
                tooltip.innerHTML = `<strong>${name}</strong>${desc}`;
                tooltip.style.opacity = '1';
                
                // Position tooltip
                const containerRect = svgContainer.getBoundingClientRect();
                let left = e.clientX - containerRect.left + 15;
                let top = e.clientY - containerRect.top + 15;

                // Boundary check
                if (left + 250 > containerRect.width) {
                    left -= 265;
                }
                if (top + 100 > containerRect.height) {
                    top -= 120;
                }

                tooltip.style.left = `${left}px`;
                tooltip.style.top = `${top}px`;
            });

            part.addEventListener('mouseleave', () => {
                tooltip.style.opacity = '0';
            });
        });

        // Animation Loop / Update Function
        function updateSimulation() {
            const dni = parseInt(slider.value);

            // 1. Update Text Display
            displayValue.textContent = `${dni} W/m²`;

            // 2. Calculate Voltage
            const voltage = (dni * SENSITIVITY).toFixed(3);
            voltageText.textContent = `${voltage} mV`;

            // 3. Update Heat Glow (Bottom of tube)
            const glowOpacity = (dni / MAX_DNI) * 0.9;
            heatGlow.setAttribute('opacity', glowOpacity);

            // 4. Update Rays
            const rayOpacity = Math.max(0, (dni / MAX_DNI));
            
            // Access lines inside the solarRays group
            const lines = solarRays.querySelectorAll('line');
            lines.forEach(line => {
                line.setAttribute('opacity', rayOpacity);
                // Make them move faster with higher intensity
                // Note: Changing animation duration in JS can be jerky, 
                // so we primarily stick to opacity for intensity.
            });

            // 5. LED Indicator logic
            if (dni > 50) {
                statusLed.setAttribute('fill', '#00ff00'); // Green when active
            } else {
                statusLed.setAttribute('fill', '#555'); // Dark when inactive
            }
        }

        // Initialize
        slider.addEventListener('input', updateSimulation);
        
        // Initial call
        updateSimulation();

        // Intro Animation
        setTimeout(() => {
            // Animate slider up
            let startVal = 0;
            const targetVal = 950;
            const animInterval = setInterval(() => {
                if (startVal < targetVal) {
                    startVal += 15;
                    slider.value = startVal;
                    updateSimulation();
                } else {
                    clearInterval(animInterval);
                }
            }, 10);
        }, 500);

    </script>
</body>
</html>
